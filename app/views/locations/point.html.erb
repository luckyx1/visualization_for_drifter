<% if Location.any? %>
	<div id="map">	
	<script>
		var map = new L.Map('map', {center: new L.LatLng(<%= first_lat%>-0.36093, <%= first_long%>+.26494), zoom: 16});
		//0.36093, -122.25803
  		var googleLayer = new L.Google('SATELLITE');
  		map.addLayer(googleLayer);
  		var smile = L.AwesomeMarkers.icon({
		    icon: 'fa-smile-o',
		    prefix: 'fa',
		    markerColor:'orange'
		});
					console.log("this partical is called")
		$(document).ready(function () {
		    // will call refreshPartial every 3 seconds
		    setInterval(refreshPartial, 3000)

		});

		// calls action refreshing the partial
		function refreshPartial() {
			$.getJSON( "simulation", function( data ) {
		  		console.log(data);
		  		  $.each(data,function(key,value){
		  		  	console.log(value);
		  		  	console.log(value.time);
					L.marker([ value.latitude , value.longitude], {icon: smile, riseOnHover:true}).addTo(map).bindPopup("<b>"+value.drifter_name+", "+value.time+". My current speed is "+value.gps_speed+"</b>").openPopup();
					var popup = L.popup();
					function onMapClick(e) {
						popup
							.setLatLng(e.latlng)
							.setContent("You clicked the map at " + e.latlng.toString())
							.openOn(map);
					}
					map.on('click', onMapClick);
		  		  });
			});
		}
	</script>
	</div>
<% else %>
	Please wait for first data point to come in...
<% end %>

